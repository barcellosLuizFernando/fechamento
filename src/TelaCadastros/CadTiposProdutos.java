/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package TelaCadastros;

import conn.ConexaoMySQL;
import java.sql.SQLException;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author luiz.barcellos
 */
public class CadTiposProdutos extends javax.swing.JInternalFrame {

    private int var_consulta;

    private ConexaoMySQL cn = new ConexaoMySQL();

    /**
     * Creates new form CadTiposProdutos
     */
    public CadTiposProdutos(ConexaoMySQL conn) {
        initComponents();
        this.cn = conn;
        montaTabela();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPesquisar = new javax.swing.JFrame();
        jPanel4 = new javax.swing.JPanel();
        jTxtPesquisa_Multi = new javax.swing.JTextField();
        jBtnConfirmar = new javax.swing.JButton();
        jBtnCancelar = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        jTblConsulta_Multi = new javax.swing.JTable();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jTxtId = new javax.swing.JTextField();
        jTxtDescricao = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jBtnPesquisa = new javax.swing.JButton();
        jTxtIdBase = new javax.swing.JTextField();
        jTxtNomeBase = new javax.swing.JTextField();
        jBtnPesquisaBase = new javax.swing.JButton();
        jLabel5 = new javax.swing.JLabel();
        jSpinner1 = new javax.swing.JSpinner();
        jPanel2 = new javax.swing.JPanel();
        jBtnIncluir = new javax.swing.JButton();
        jBtnEditar = new javax.swing.JButton();
        jBtnGravar = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jPanel3 = new javax.swing.JPanel();
        jBtnAdd = new javax.swing.JButton();
        jBtnAddM = new javax.swing.JButton();

        jPesquisar.setTitle("Pesquisar");
        jPesquisar.setMinimumSize(new java.awt.Dimension(700, 400));

        jTxtPesquisa_Multi.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTxtPesquisa_Multi.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTxtPesquisa_MultiKeyReleased(evt);
            }
        });

        jBtnConfirmar.setText("Adicionar");
        jBtnConfirmar.setEnabled(false);
        jBtnConfirmar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnConfirmarActionPerformed(evt);
            }
        });

        jBtnCancelar.setText("Cancelar");
        jBtnCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnCancelarActionPerformed(evt);
            }
        });

        jTblConsulta_Multi.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTblConsulta_Multi.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jTblConsulta_Multi.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTblConsulta_MultiMouseClicked(evt);
            }
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                jTblConsulta_MultiMouseEntered(evt);
            }
        });
        jScrollPane4.setViewportView(jTblConsulta_Multi);

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel4Layout.createSequentialGroup()
                        .addGap(0, 453, Short.MAX_VALUE)
                        .addComponent(jBtnCancelar)
                        .addGap(18, 18, 18)
                        .addComponent(jBtnConfirmar))
                    .addComponent(jTxtPesquisa_Multi)
                    .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTxtPesquisa_Multi, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane4, javax.swing.GroupLayout.DEFAULT_SIZE, 180, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jBtnConfirmar)
                    .addComponent(jBtnCancelar))
                .addContainerGap())
        );

        javax.swing.GroupLayout jPesquisarLayout = new javax.swing.GroupLayout(jPesquisar.getContentPane());
        jPesquisar.getContentPane().setLayout(jPesquisarLayout);
        jPesquisarLayout.setHorizontalGroup(
            jPesquisarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        jPesquisarLayout.setVerticalGroup(
            jPesquisarLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        setClosable(true);
        setTitle("Cadastro de Produtos");

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel1.setText("Código");

        jLabel2.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel2.setText("Descrição");

        jTxtId.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTxtId.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtIdFocusLost(evt);
            }
        });

        jTxtDescricao.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTxtDescricao.setEnabled(false);

        jLabel4.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel4.setText("Base");

        jBtnPesquisa.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnPesquisa.setText("...");
        jBtnPesquisa.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnPesquisaActionPerformed(evt);
            }
        });

        jTxtIdBase.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTxtIdBase.setEnabled(false);
        jTxtIdBase.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtIdBaseFocusLost(evt);
            }
        });

        jTxtNomeBase.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTxtNomeBase.setEnabled(false);

        jBtnPesquisaBase.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnPesquisaBase.setText("...");
        jBtnPesquisaBase.setEnabled(false);
        jBtnPesquisaBase.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnPesquisaBaseActionPerformed(evt);
            }
        });

        jLabel5.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel5.setText("%");

        jSpinner1.setModel(new javax.swing.SpinnerNumberModel(110.0d, null, null, 1.0d));
        jSpinner1.setEditor(new javax.swing.JSpinner.NumberEditor(jSpinner1, "0.00"));
        jSpinner1.setEnabled(false);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel4)
                    .addComponent(jLabel2)
                    .addComponent(jLabel1))
                .addGap(10, 10, 10)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jTxtDescricao)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jTxtId, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jBtnPesquisa))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jTxtIdBase, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jTxtNomeBase, javax.swing.GroupLayout.DEFAULT_SIZE, 394, Short.MAX_VALUE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jBtnPesquisaBase)
                                .addGap(18, 18, 18)
                                .addComponent(jLabel5)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jSpinner1, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(jTxtId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBtnPesquisa, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(8, 8, 8)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(jTxtDescricao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(jTxtIdBase, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTxtNomeBase, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBtnPesquisaBase, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jLabel5)
                    .addComponent(jSpinner1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        jBtnIncluir.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnIncluir.setText("Adicionar");
        jBtnIncluir.setToolTipText("Insere mais um registro.");
        jBtnIncluir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnIncluirActionPerformed(evt);
            }
        });

        jBtnEditar.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnEditar.setText("Editar");
        jBtnEditar.setEnabled(false);
        jBtnEditar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnEditarActionPerformed(evt);
            }
        });

        jBtnGravar.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnGravar.setText("Gravar");
        jBtnGravar.setEnabled(false);
        jBtnGravar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnGravarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jBtnIncluir, javax.swing.GroupLayout.DEFAULT_SIZE, 93, Short.MAX_VALUE)
                            .addComponent(jBtnEditar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                    .addComponent(jBtnGravar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jBtnIncluir, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jBtnEditar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jBtnGravar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(jTable1);

        jBtnAdd.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnAdd.setText("(+)");
        jBtnAdd.setToolTipText("Insere mais um registro.");
        jBtnAdd.setEnabled(false);
        jBtnAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnAddActionPerformed(evt);
            }
        });

        jBtnAddM.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jBtnAddM.setText("( - )");
        jBtnAddM.setToolTipText("Insere mais um registro.");
        jBtnAddM.setEnabled(false);
        jBtnAddM.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBtnAddMActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jBtnAdd, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jBtnAddM, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jBtnAdd)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jBtnAddM)
                .addContainerGap(212, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 660, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jTxtIdFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtIdFocusLost
        if (!"".equals(jTxtId.getText())) {
            var_consulta = 11;

            String id = jTxtId.getText();
            limpaCampos();
            jTxtId.setText(id);
            incluiPesquisa();

        }        // TODO add your handling code here:
    }//GEN-LAST:event_jTxtIdFocusLost

    private void jBtnPesquisaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnPesquisaActionPerformed
        var_consulta = 1;

        jPesquisar.setVisible(true);
        montaLista();
    }//GEN-LAST:event_jBtnPesquisaActionPerformed

    private void jBtnIncluirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnIncluirActionPerformed
        limpaCampos();

        if ("Adicionar".equals(jBtnIncluir.getText())) {

            habilitarEdicao();

            jBtnIncluir.setText("Cancelar");
            jBtnEditar.setEnabled(false);

            jTxtId.setText("NOVO");
        } else {

            desabilitarEdicao();
            jTxtId.setText("");
        }
    }//GEN-LAST:event_jBtnIncluirActionPerformed

    private void jBtnEditarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnEditarActionPerformed
        if ("Editar".equals(jBtnEditar.getText())) {
            habilitarEdicao();

            jBtnEditar.setText("Cancelar");
            jBtnIncluir.setEnabled(false);
        } else {
            limpaCampos();
            desabilitarEdicao();
        }
    }//GEN-LAST:event_jBtnEditarActionPerformed

    private void jBtnGravarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnGravarActionPerformed
        String id = jTxtId.getText();
        String descricao = jTxtDescricao.getText().toUpperCase();
        String id_base;
        String percentual;

        String sql;

        if (!"".equals(jTxtNomeBase.getText())) {
            id_base = jTxtIdBase.getText();
            percentual = "'" + jSpinner1.getValue() + "'";
        } else {
            id_base = null;
            percentual = null;
        }

        if ("Cancelar".equals(jBtnIncluir.getText())) {

            sql = "INSERT INTO cad_produtos (descricao, base, percentual) "
                    + "VALUES ('" + descricao + "'," + id_base + "," + percentual + ")";

            try {
                cn.iniciarTransacao();
                cn.executeConsulta("SHOW TABLE STATUS like 'cad_produtos';");
                while (cn.rs.next()) {
                    id = cn.rs.getString("auto_increment");
                }
            } catch (SQLException ex) {
                JOptionPane.showMessageDialog(this, "Não foi possível capturar a próxima ID.");
            }
            cn.finalizarTransacao();

        } else {
            sql = "UPDATE cad_produtos SET DESCRICAO = '" + descricao
                    + "', base = " + id_base + ", percentual = " + percentual
                    + " WHERE ID = " + jTxtId.getText();

        }

        if (!"".equals(jTxtDescricao.getText())) {
            try {
                cn.iniciarTransacao();
                cn.executeAtualizacao(sql);
            } catch (SQLException e) {
                tools.DefaultMsg.errorMsg(e.getMessage());
            } finally {
                cn.finalizarTransacao();
            }
            jTxtId.setText(id);

            desabilitarEdicao();
            habilitaMercadorias();

        } else {
            JOptionPane.showMessageDialog(rootPane, "Preencher descrição!");
        }


    }//GEN-LAST:event_jBtnGravarActionPerformed

    private void jTxtPesquisa_MultiKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtPesquisa_MultiKeyReleased
        montaLista();
        // TODO add your handling code here:
    }//GEN-LAST:event_jTxtPesquisa_MultiKeyReleased

    private void jBtnConfirmarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnConfirmarActionPerformed
        incluiPesquisa();
        jPesquisar.dispose();// TODO add your handling code here:
    }//GEN-LAST:event_jBtnConfirmarActionPerformed

    private void jBtnCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnCancelarActionPerformed
        jPesquisar.setVisible(false);        // TODO add your handling code here:
        jPesquisar.dispose();        // TODO add your handling code here:
    }//GEN-LAST:event_jBtnCancelarActionPerformed

    private void jTblConsulta_MultiMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTblConsulta_MultiMouseClicked
        jBtnConfirmar.setEnabled(true);    // TODO add your handling code here:
    }//GEN-LAST:event_jTblConsulta_MultiMouseClicked

    private void jTblConsulta_MultiMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTblConsulta_MultiMouseEntered
        // TODO add your handling code here:
    }//GEN-LAST:event_jTblConsulta_MultiMouseEntered

    private void jBtnAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnAddActionPerformed
        var_consulta = 3;

        jPesquisar.setVisible(true);

        montaLista();
    }//GEN-LAST:event_jBtnAddActionPerformed

    private void jBtnPesquisaBaseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnPesquisaBaseActionPerformed
        var_consulta = 2;

        jPesquisar.setVisible(true);

        montaLista();

    }//GEN-LAST:event_jBtnPesquisaBaseActionPerformed

    private void jTxtIdBaseFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtIdBaseFocusLost
        jTxtNomeBase.setText("");

        if (jTxtId.getText().equals(jTxtIdBase.getText())) {
            JOptionPane.showMessageDialog(this, "O produto base não pode ser igual ao produto atual.");
            jTxtIdBase.setText("");
        } else if (!"".equals(jTxtIdBase.getText())) {

            var_consulta = 22;

            incluiPesquisa();

        }
        habilitarEdicao();
    }//GEN-LAST:event_jTxtIdBaseFocusLost

    private void jBtnAddMActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBtnAddMActionPerformed
        int linha = jTable1.getSelectedRow();

        if (linha > -1) {

            String id = jTxtId.getText();
            String id_mercadoria = jTable1.getValueAt(linha, 0).toString();

            try {
                cn.iniciarTransacao();
                cn.executeAtualizacao("DELETE FROM cad_produtos_detalhe WHERE id = " + id + " AND id_mercadoria = " + id_mercadoria);
                var_consulta = 33;
                incluiPesquisa();
            } catch (SQLException e) {
                tools.DefaultMsg.errorMsg(e.getMessage());
            } finally {
                cn.finalizarTransacao();
            }

        } else {
            JOptionPane.showMessageDialog(this, "Selecione uma linha para continuar.");
        }
    }//GEN-LAST:event_jBtnAddMActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jBtnAdd;
    private javax.swing.JButton jBtnAddM;
    private javax.swing.JButton jBtnCancelar;
    private javax.swing.JButton jBtnConfirmar;
    private javax.swing.JButton jBtnEditar;
    private javax.swing.JButton jBtnGravar;
    private javax.swing.JButton jBtnIncluir;
    private javax.swing.JButton jBtnPesquisa;
    private javax.swing.JButton jBtnPesquisaBase;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JFrame jPesquisar;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JSpinner jSpinner1;
    private javax.swing.JTable jTable1;
    private javax.swing.JTable jTblConsulta_Multi;
    private javax.swing.JTextField jTxtDescricao;
    private javax.swing.JTextField jTxtId;
    private javax.swing.JTextField jTxtIdBase;
    private javax.swing.JTextField jTxtNomeBase;
    private javax.swing.JTextField jTxtPesquisa_Multi;
    // End of variables declaration//GEN-END:variables

    private void limpaCampos() {
        jTxtId.setText("");
        jTxtDescricao.setText("");
        jTxtIdBase.setText("");
        jTxtNomeBase.setText("");

        montaTabela();
    }

    private void habilitarEdicao() {
        jTxtId.setEnabled(false);
        jTxtDescricao.setEnabled(true);
        jTxtIdBase.setEnabled(true);

        if (!"".equals(jTxtNomeBase.getText())) {
            jSpinner1.setEnabled(true);
        } else {
            jSpinner1.setEnabled(false);

        }

        jBtnPesquisa.setEnabled(false);
        jBtnPesquisaBase.setEnabled(true);
        jBtnGravar.setEnabled(true);
    }

    private void desabilitarEdicao() {
        String id = jTxtId.getText();

        jTxtId.setEnabled(true);
        jTxtDescricao.setEnabled(false);
        jTxtIdBase.setEnabled(false);
        jTxtNomeBase.setEnabled(false);
        jSpinner1.setEnabled(false);

        jBtnEditar.setEnabled(false);
        jBtnAdd.setEnabled(false);
        jBtnAddM.setEnabled(false);
        jBtnIncluir.setEnabled(true);
        jBtnPesquisa.setEnabled(true);
        jBtnPesquisaBase.setEnabled(false);
        jBtnGravar.setEnabled(false);
        jBtnIncluir.setText("Adicionar");
        jBtnEditar.setText("Editar");

        if (!"".equals(id)
                && !"NOVO".equals(id)) {
            jBtnEditar.setEnabled(true);
            habilitaMercadorias();
        }
    }

    private void incluiPesquisa() {

        String sql;
        String id;
        String id_base;
        Double percentual;

        int linha = jTblConsulta_Multi.getSelectedRow();

        switch (var_consulta) {
            case 1:

                jTxtId.setText(jTblConsulta_Multi.getValueAt(linha, 0).toString());

            case 11:

                id = jTxtId.getText();

                sql = "SELECT * FROM cad_produtos WHERE id = " + id;

                try {
                cn.iniciarTransacao();
                cn.executeConsulta(sql);
                    while (cn.rs.next()) {
                        jTxtDescricao.setText(cn.rs.getString("descricao"));
                        jTxtIdBase.setText(cn.rs.getString("base"));

                        if (cn.rs.getInt("base") > 0) {
                            percentual = cn.rs.getDouble("percentual");
                        } else {
                            percentual = 0.00;
                        }

                        jSpinner1.setValue(percentual);

                    }
                } catch (Exception ex) {
                    JOptionPane.showMessageDialog(this, "Não foi possível capturar os dados do produto.");
                }

                if (!"".equals(jTxtDescricao.getText())) {
                    jBtnEditar.setEnabled(true);
                } else {

                    jBtnEditar.setEnabled(false);
                }

                cn.finalizarTransacao();

                if (!"".equals(jTxtIdBase.getText())) {
                    var_consulta = 22;
                    incluiPesquisa();
                }
                var_consulta = 33;
                incluiPesquisa();

                habilitaMercadorias();

                break;

            case 2:

                jTxtIdBase.setText(jTblConsulta_Multi.getValueAt(linha, 0).toString());

            case 22:

                id = jTxtIdBase.getText();

                sql = "SELECT * FROM cad_produtos WHERE id = " + id;

                try {
                cn.iniciarTransacao();
                cn.executeConsulta(sql);
                    while (cn.rs.next()) {
                        jTxtNomeBase.setText(cn.rs.getString("descricao"));
                    }

                } catch (Exception ex) {
                    JOptionPane.showMessageDialog(this, "Não foi possível consultar o bem base. " + ex);
                }
                cn.finalizarTransacao();
                break;

            case 3:
                id = jTxtId.getText();
                cn.iniciarTransacao();
                for (int x = jTblConsulta_Multi.getSelectedRowCount(); x != 0; x--) {

                    linha = jTblConsulta_Multi.getSelectedRow();

                    try {
                        String id_mercadoria = jTblConsulta_Multi.getValueAt(linha, 0).toString();
                        String mercadoria = jTblConsulta_Multi.getValueAt(linha, 1).toString();

                        sql = "INSERT INTO cad_produtos_detalhe (id,id_mercadoria,nome) "
                                + "VALUES ('" + id + "','" + id_mercadoria + "','" + mercadoria + "');";

                        cn.executeAtualizacao(sql);

                        //JOptionPane.showMessageDialog(this, "Linha selecionada: " + linha + ". Data selecionada + " + data);
                        jTblConsulta_Multi.removeRowSelectionInterval(linha, linha);
                    } catch (Exception e) {
                        JOptionPane.showMessageDialog(this, "Erro ao gravar no banco de dados: " + e);
                    }
                }
                cn.finalizarTransacao();

            case 33:
                DefaultTableModel lista = (DefaultTableModel) jTable1.getModel();

                id = jTxtId.getText();
                sql = "SELECT * FROM cad_produtos_detalhe "
                        + "WHERE id = " + id
                        + " ORDER BY nome;";

                montaTabela();

                try {
                cn.iniciarTransacao();
                cn.executeConsulta(sql);
                    while (cn.rs.next()) {

                        lista.addRow(new String[]{
                            cn.rs.getString("id_mercadoria"),
                            cn.rs.getString("nome")
                        });
                    }
                } catch (SQLException ex) {

                    JOptionPane.showMessageDialog(null, "Erro ao consultar o banco de dados: " + ex);
                }
                cn.finalizarTransacao();

        }
    }

    private void montaLista() {
        DefaultTableModel lista = (DefaultTableModel) jTblConsulta_Multi.getModel();

        lista.setColumnCount(0);
        lista.setRowCount(0);

        lista.addColumn("Id");
        lista.addColumn("Descrição");

        jTblConsulta_Multi.getColumnModel().getColumn(0).setMaxWidth(50);
        jTblConsulta_Multi.getColumnModel().getColumn(0).setMinWidth(50);
        jTblConsulta_Multi.getTableHeader().getColumnModel().getColumn(0).setMaxWidth(50);
        jTblConsulta_Multi.getTableHeader().getColumnModel().getColumn(0).setMinWidth(50);

        String sql;
        String texto = jTxtPesquisa_Multi.getText();
        String condicao;

        cn.iniciarTransacao();
        switch (var_consulta) {
            case 1:

                if (!"".equals(texto)) {
                    condicao = "WHERE UPPER(descricao) "
                            + "LIKE '%" + texto.toUpperCase() + "%' ";
                } else {
                    condicao = "";
                }

                sql = "SELECT * FROM cad_produtos "
                        + condicao
                        + "ORDER BY descricao";

                try {
                cn.executeConsulta(sql);

                    while (cn.rs.next()) {

                        lista.addRow(new String[]{
                            cn.rs.getString("id"),
                            cn.rs.getString("descricao")
                        });
                    }
                } catch (SQLException ex) {

                    JOptionPane.showMessageDialog(null, "Erro ao consultar o banco de dados: " + ex);
                }

                break;

            case 2:

                if (!"".equals(texto)) {
                    condicao = "AND UPPER(descricao) "
                            + "LIKE '%" + texto.toUpperCase() + "%' ";
                } else {
                    condicao = "";
                }

                sql = "SELECT * FROM cad_produtos "
                        + "WHERE id != '" + jTxtId.getText() + "' "
                        + condicao
                        + "ORDER BY descricao";

                try {
                cn.executeConsulta(sql);

                    while (cn.rs.next()) {

                        lista.addRow(new String[]{
                            cn.rs.getString("id"),
                            cn.rs.getString("descricao")
                        });
                    }
                } catch (SQLException ex) {

                    JOptionPane.showMessageDialog(null, "Erro ao consultar o banco de dados: " + ex);
                }

                break;

            case 3:
                sql = "SELECT DISTINCT a.cod_mercadoria, a.mercadoria "
                        + "FROM estoque_disp a "
                        + "LEFT JOIN cad_setores b on b.id = a.setor "
                        + "WHERE a.proprio < 0 "
                        + "AND a.cod_mercadoria not in (select id_mercadoria from cad_produtos_detalhe) "
                        + "AND b.controla_cmv = 2 "
                        + "ORDER BY a.mercadoria;";

                try {
                cn.executeConsulta(sql);
                    while (cn.rs.next()) {

                        lista.addRow(new String[]{
                            cn.rs.getString("cod_mercadoria"),
                            cn.rs.getString("mercadoria")
                        });
                    }
                } catch (SQLException ex) {

                    JOptionPane.showMessageDialog(null, "Erro ao consultar o banco de dados: " + ex);
                }

                break;

        }
        cn.finalizarTransacao();

    }

    private void habilitaMercadorias() {
        String id = jTxtId.getText();

        if (!"".equals(id)
                && !"NOVO".equals(id)
                && !"".equals(jTxtDescricao.getText())) {
            jBtnAdd.setEnabled(true);
            jBtnAddM.setEnabled(true);
        } else {
            jBtnAdd.setEnabled(false);
            jBtnAddM.setEnabled(false);

        }
    }

    private void montaTabela() {
        DefaultTableModel lista = (DefaultTableModel) jTable1.getModel();

        lista.setRowCount(0);
        lista.setColumnCount(0);

        lista.addColumn("Id");
        lista.addColumn("Mercadoria");

        jTable1.getColumnModel().getColumn(0).setMaxWidth(50);
        jTable1.getColumnModel().getColumn(0).setMinWidth(50);
        jTable1.getTableHeader().getColumnModel().getColumn(0).setMaxWidth(50);
        jTable1.getTableHeader().getColumnModel().getColumn(0).setMinWidth(50);
    }

}
