/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package calendar;

import java.awt.event.KeyEvent;
import java.sql.SQLException;
import javax.swing.JTextField;

/**
 *
 * @author luiz.barcellos
 */
public class IntFrm_TaxStatements extends javax.swing.JInternalFrame {

    private final conn.ConexaoMySQL cn;
    private String lastId;

    private final int SEARCH_TAX_STATEMENTS = 0;
    private final int SEARCH_DEPARTMENT = 1;
    private int var_consulta;
    private String sql;

    /**
     * Creates new form IntFrm_TaxStatements
     *
     * @param conn
     */
    public IntFrm_TaxStatements(final conn.ConexaoMySQL conn) {
        initComponents();
        this.cn = conn;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jTxtId = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jTxtAlias = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jTxtDescription = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jTxtIdDepartment = new javax.swing.JTextField();
        jTxtDepartmentName = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        jCbGovernmet = new javax.swing.JComboBox<>();
        jLabel6 = new javax.swing.JLabel();
        jCbPeriod = new javax.swing.JComboBox<>();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextAreaPenalties = new javax.swing.JTextArea();
        jPanel3 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTextAreaLegalGrounds = new javax.swing.JTextArea();
        jLabel7 = new javax.swing.JLabel();
        jCbType = new javax.swing.JComboBox<>();
        jLabel9 = new javax.swing.JLabel();
        jTxtPayDay = new javax.swing.JTextField();
        jChBLastDay = new javax.swing.JCheckBox();
        jChBNextMonth = new javax.swing.JCheckBox();
        jLabel8 = new javax.swing.JLabel();
        jTxtTaxCode = new javax.swing.JTextField();
        jChBActive = new javax.swing.JCheckBox();
        jChBDiaUtil = new javax.swing.JCheckBox();
        jPanel4 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();

        setClosable(true);
        setTitle("Obrigações Fiscais");

        jLabel1.setText("Código");

        jTxtId.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtIdFocusLost(evt);
            }
        });
        jTxtId.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTxtIdKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTxtIdKeyReleased(evt);
            }
        });

        jLabel2.setText("Sigla");

        jLabel3.setText("Descrição");

        jLabel4.setText("Departamento");

        jTxtIdDepartment.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jTxtIdDepartmentFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtIdDepartmentFocusLost(evt);
            }
        });
        jTxtIdDepartment.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTxtIdDepartmentKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTxtIdDepartmentKeyReleased(evt);
            }
        });

        jTxtDepartmentName.setEnabled(false);

        jLabel5.setText("Esfera Governamental");

        jCbGovernmet.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "FEDERAL", "ESTADUAL", "MUNICIPAL", "NENHUM" }));

        jLabel6.setText("Periodicidade");

        jCbPeriod.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "DIARIO", "DECENDIAL", "QUINZENAL", "MENSAL", "TRIMESTRAL", "ANUAL", "QUINQUENAL", "INDETERMINADO", "OUTRO" }));

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder("Penalidades"));

        jTextAreaPenalties.setColumns(20);
        jTextAreaPenalties.setLineWrap(true);
        jTextAreaPenalties.setRows(5);
        jTextAreaPenalties.setToolTipText("Informe como será cobrada a multa, caso não seja atendida a obrigação.");
        jTextAreaPenalties.setWrapStyleWord(true);
        jScrollPane1.setViewportView(jTextAreaPenalties);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane1)
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 107, Short.MAX_VALUE)
        );

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder("Base Legal"));

        jTextAreaLegalGrounds.setColumns(20);
        jTextAreaLegalGrounds.setLineWrap(true);
        jTextAreaLegalGrounds.setRows(5);
        jTextAreaLegalGrounds.setToolTipText("Informe todas as leis que sustentam esta obrigação.");
        jTextAreaLegalGrounds.setWrapStyleWord(true);
        jScrollPane2.setViewportView(jTextAreaLegalGrounds);

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane2)
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 107, Short.MAX_VALUE)
        );

        jLabel7.setText("Tipo");

        jCbType.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "TRIBUTO", "DECLARAÇÃO", "OUTRO" }));

        jLabel9.setText("Dia do Vencimento");

        jTxtPayDay.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jTxtPayDayFocusLost(evt);
            }
        });
        jTxtPayDay.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTxtPayDayKeyReleased(evt);
            }
        });

        jChBLastDay.setText("Último dia");
        jChBLastDay.setToolTipText("Vencimento no último dia do mês");
        jChBLastDay.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jChBLastDayActionPerformed(evt);
            }
        });

        jChBNextMonth.setText("Mês Seguinte");
        jChBNextMonth.setToolTipText("Vencimento no mês seguinte do período de apuração");

        jLabel8.setText("Código Recolhimento");

        jTxtTaxCode.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTxtTaxCodeKeyReleased(evt);
            }
        });

        jChBActive.setSelected(true);
        jChBActive.setText("Ativo");
        jChBActive.setToolTipText("Vencimento no mês seguinte do período de apuração");

        jChBDiaUtil.setText("Dia Útil");
        jChBDiaUtil.setToolTipText("Vencimento no mês seguinte do período de apuração");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel2)
                    .addComponent(jLabel1)
                    .addComponent(jLabel4)
                    .addComponent(jLabel7))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jTxtIdDepartment, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTxtDepartmentName)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jCbGovernmet, javax.swing.GroupLayout.PREFERRED_SIZE, 99, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel6)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jCbPeriod, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jTxtId, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(jCbType, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(jLabel9)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jTxtPayDay, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(jChBLastDay)
                                .addGap(18, 18, 18)
                                .addComponent(jChBNextMonth)
                                .addGap(18, 18, 18)
                                .addComponent(jChBDiaUtil)
                                .addGap(18, 18, 18)
                                .addComponent(jChBActive)))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(jTxtAlias, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTxtDescription, javax.swing.GroupLayout.PREFERRED_SIZE, 392, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel8)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTxtTaxCode, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE))))
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(jTxtId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(jTxtAlias, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3)
                    .addComponent(jTxtDescription, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel8)
                    .addComponent(jTxtTaxCode, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(jTxtPayDay, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jChBLastDay)
                    .addComponent(jChBNextMonth)
                    .addComponent(jLabel7)
                    .addComponent(jCbType, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jChBActive)
                    .addComponent(jChBDiaUtil))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(jTxtIdDepartment, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTxtDepartmentName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel5)
                    .addComponent(jCbGovernmet, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6)
                    .addComponent(jCbPeriod, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        jButton1.setText("Gravar");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setText("Excluir");

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel4Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 90, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 90, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jButton1)
            .addComponent(jButton2)
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jTxtPayDayFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtPayDayFocusLost
        if (!"".equals(jTxtPayDay.getText())) {
            jChBLastDay.setSelected(false);
        }
    }//GEN-LAST:event_jTxtPayDayFocusLost

    private void jChBLastDayActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jChBLastDayActionPerformed
        if (jChBLastDay.isSelected()) {
            jTxtPayDay.setText("");
        }
    }//GEN-LAST:event_jChBLastDayActionPerformed

    private void jTxtIdDepartmentFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtIdDepartmentFocusGained
        lastId = jTxtIdDepartment.getText();
    }//GEN-LAST:event_jTxtIdDepartmentFocusGained

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        saveData();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jTxtIdDepartmentKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtIdDepartmentKeyPressed
        tools.AcaoPadrao.acaoPadraoCodigoSequencial(jTxtIdDepartment, evt);
        if (evt.getKeyCode() == KeyEvent.VK_UP | evt.getKeyCode() == KeyEvent.VK_DOWN) {
            var_consulta = SEARCH_DEPARTMENT;
            incluiPesquisa();
        }
    }//GEN-LAST:event_jTxtIdDepartmentKeyPressed

    private void jTxtIdFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtIdFocusLost
        updateIndex(SEARCH_TAX_STATEMENTS, jTxtId, jTxtDescription);
    }//GEN-LAST:event_jTxtIdFocusLost

    private void jTxtIdKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtIdKeyPressed
        tools.AcaoPadrao.acaoPadraoCodigoSequencial(jTxtId, evt);
        var_consulta = SEARCH_TAX_STATEMENTS;
        incluiPesquisa();
    }//GEN-LAST:event_jTxtIdKeyPressed

    private void jTxtIdKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtIdKeyReleased
        tools.RemoveSpecialChar.removeChars(jTxtId);
    }//GEN-LAST:event_jTxtIdKeyReleased

    private void jTxtIdDepartmentKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtIdDepartmentKeyReleased
        tools.RemoveSpecialChar.removeChars(jTxtIdDepartment);        // TODO add your handling code here:
    }//GEN-LAST:event_jTxtIdDepartmentKeyReleased

    private void jTxtTaxCodeKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtTaxCodeKeyReleased
        tools.RemoveSpecialChar.removeChars(jTxtTaxCode);        // TODO add your handling code here:
    }//GEN-LAST:event_jTxtTaxCodeKeyReleased

    private void jTxtPayDayKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTxtPayDayKeyReleased
        tools.RemoveSpecialChar.removeChars(jTxtPayDay);        // TODO add your handling code here:
    }//GEN-LAST:event_jTxtPayDayKeyReleased

    private void jTxtIdDepartmentFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jTxtIdDepartmentFocusLost
        updateIndex(SEARCH_DEPARTMENT, jTxtIdDepartment, jTxtDepartmentName);
    }//GEN-LAST:event_jTxtIdDepartmentFocusLost


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JComboBox<String> jCbGovernmet;
    private javax.swing.JComboBox<String> jCbPeriod;
    private javax.swing.JComboBox<String> jCbType;
    private javax.swing.JCheckBox jChBActive;
    private javax.swing.JCheckBox jChBDiaUtil;
    private javax.swing.JCheckBox jChBLastDay;
    private javax.swing.JCheckBox jChBNextMonth;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTextArea jTextAreaLegalGrounds;
    private javax.swing.JTextArea jTextAreaPenalties;
    private javax.swing.JTextField jTxtAlias;
    private javax.swing.JTextField jTxtDepartmentName;
    private javax.swing.JTextField jTxtDescription;
    private javax.swing.JTextField jTxtId;
    private javax.swing.JTextField jTxtIdDepartment;
    private javax.swing.JTextField jTxtPayDay;
    private javax.swing.JTextField jTxtTaxCode;
    // End of variables declaration//GEN-END:variables

    private void saveData() {

        try {
            cn.iniciarTransacao();

            if (jTxtAlias.getText().equals("")) {
                jTxtAlias.grabFocus();
                throw new UnsupportedOperationException("Informe uma sigla.");
            }
            if (jTxtDescription.getText().equals("")) {
                jTxtDescription.grabFocus();
                throw new UnsupportedOperationException("Informe uma descrição.");
            }
            if (jTxtPayDay.getText().equals("") && jChBLastDay.isSelected() == false) {
                jTxtPayDay.grabFocus();
                throw new UnsupportedOperationException("Informe um dia para o vencimento ou marque como sendo o último dia do mês.");
            }
            if (jTxtDepartmentName.getText().equals("")) {
                jTxtDepartmentName.grabFocus();
                throw new UnsupportedOperationException("Informe um departamento.");
            }

            String id = jTxtId.getText();
            String alias = jTxtAlias.getText();
            String description = jTxtDescription.getText();
            String tax_code = jTxtTaxCode.getText();
            int type = jCbType.getSelectedIndex();
            String payday = jTxtPayDay.getText();
            boolean lastDay = jChBLastDay.isSelected();
            boolean nextMonth = jChBNextMonth.isSelected();
            boolean active = jChBActive.isSelected();
            boolean utilDay = jChBDiaUtil.isSelected();
            String department = jTxtIdDepartment.getText();
            int government = jCbGovernmet.getSelectedIndex();
            int period = jCbPeriod.getSelectedIndex();
            String penalties = jTextAreaPenalties.getText();
            String legal_base = jTextAreaLegalGrounds.getText();

            if ("".equals(jTxtId.getText())) {

                sql = "INSERT INTO fechamento.tax_statements (alias,type,"
                        + "description, department, government, period,"
                        + " active,p_lastday, p_nextmonth, utilday ";
                if (!"".equals(penalties)) {
                    sql += ", penalties ";
                }
                if (!"".equals(legal_base)) {
                    sql += ", legal_base ";
                }
                if (!"".equals(payday)) {
                    sql += ", p_payday ";
                }
                if (!"".equals(tax_code)) {
                    sql += ", tax_code ";
                }

                sql += ") VALUES ('" + alias + "','" + type + "','"
                        + description + "','" + department + "','"
                        + government + "','" + period + "',"
                        + active + "," + lastDay + ","
                        + nextMonth + ", " + utilDay + " ";

                if (!"".equals(penalties)) {
                    sql += ", '" + penalties + "' ";
                }
                if (!"".equals(legal_base)) {
                    sql += ", '" + legal_base + "' ";
                }
                if (!"".equals(payday)) {
                    sql += ", '" + payday + "' ";
                }
                if (!"".equals(tax_code)) {
                    sql += ", '" + tax_code + "' ";
                }
                sql += ");";

            } else {
                sql = "UPDATE fechamento.tax_statements SET "
                        + "alias = '" + alias + "', "
                        + "type = '" + type + "', "
                        + "description = '" + description + "', "
                        + "department = '" + department + "', "
                        + "government = '" + government + "', "
                        + "period = '" + period + "', ";

                if (!"".equals(tax_code)) {
                    sql += "tax_code = '" + tax_code + "', ";
                } else {
                    sql += "tax_code = null, ";
                }

                sql += "active = " + active + ", "
                        + "p_lastday = " + lastDay + ", "
                        + "p_nextmonth = " + nextMonth + ", "
                        + "utilDay = " + utilDay + ", ";

                if (!"".equals(payday)) {
                    sql += "p_payday = '" + payday + "', ";
                } else {
                    sql += "p_payday = null, ";
                }
                if (!"".equals(penalties)) {
                    sql += "penalties = '" + penalties + "', ";
                } else {
                    sql += "penalties = null, ";
                }

                if (!"".equals(legal_base)) {
                    sql += "legal_base = '" + legal_base + "' ";

                } else {
                    sql += "legal_base = null ";

                }
                sql += " WHERE id = '" + id + "' ;";
            }

            cn.executeAtualizacao(sql);

            while (cn.rs.next()) {
                jTxtId.setText(cn.rs.getString(1));
            }

            tools.DefaultMsg.saveDataSuccessfull();
            tools.ClearFields.ClearFields(this);

        } catch (Exception e) {
            tools.DefaultMsg.errorMsg(e.getMessage());
        } finally {
            cn.finalizarTransacao();
        }

    }

    private void incluiPesquisa() {
        switch (var_consulta) {

            case SEARCH_TAX_STATEMENTS:

                String id = jTxtId.getText();

                sql = "SELECT * FROM fechamento.tax_statements "
                        + "WHERE id = '" + id + "';";

                tools.ClearFields.ClearFields(this);

                jTxtId.setText(id);

                try {
                    cn.iniciarTransacao();
                    cn.executeConsulta(sql);
                    while (cn.rs.next()) {
                        jTxtAlias.setText(cn.rs.getString("alias"));
                        jTxtDescription.setText(cn.rs.getString("description"));
                        jTxtTaxCode.setText(cn.rs.getString("tax_code"));
                        jCbType.setSelectedIndex(cn.rs.getInt("type"));
                        jCbGovernmet.setSelectedIndex(cn.rs.getInt("government"));
                        jCbPeriod.setSelectedIndex(cn.rs.getInt("period"));
                        jTxtPayDay.setText(cn.rs.getString("p_payday"));
                        jChBActive.setSelected(cn.rs.getBoolean("active"));
                        jChBDiaUtil.setSelected(cn.rs.getBoolean("utilday"));
                        jChBLastDay.setSelected(cn.rs.getBoolean("p_lastday"));
                        jChBNextMonth.setSelected(cn.rs.getBoolean("p_nextmonth"));
                        jTxtIdDepartment.setText(cn.rs.getString("department"));
                        jTextAreaPenalties.setText(cn.rs.getString("penalties"));
                        jTextAreaLegalGrounds.setText(cn.rs.getString("legal_base"));
                    }

                    var_consulta = SEARCH_DEPARTMENT;
                    incluiPesquisa();

                } catch (SQLException e) {
                    tools.DefaultMsg.errorMsg(e.getMessage());
                } finally {
                    cn.finalizarTransacao();
                }
                break;

            case SEARCH_DEPARTMENT:

                sql = "SELECT name FROM fechamento.reg_departments "
                        + "WHERE id = '" + jTxtIdDepartment.getText() + "';";
                try {
                    cn.iniciarTransacao();
                    cn.executeConsulta(sql);
                    tools.AcaoPadrao.acaoPadraoResultSet(cn.rs, jTxtDepartmentName);
                } catch (Exception e) {
                    tools.DefaultMsg.errorMsg(e.getMessage());
                } finally {
                    cn.finalizarTransacao();
                }

                break;
        }
    }

    private void updateIndex(int varcons, JTextField id, JTextField name) {

        System.out.println("Id: " + id.getText());
        System.out.println("IdAnterior: " + lastId);
        System.out.println("Nome: " + name.getText());
        System.out.println("Variavel: " + varcons);

        if (id.getText().equals("")) {
            switch (varcons) {
                case SEARCH_TAX_STATEMENTS:
                    tools.ClearFields.ClearFields(this);
                    break;

                default:
                    name.setText("");

                    break;
            }

        } else if (!id.getText().equals(lastId) && !"".equals(id.getText())) {
            var_consulta = varcons;
            incluiPesquisa();

            if ("".equals(name.getText())) {

                switch (varcons) {
                    case SEARCH_TAX_STATEMENTS:
                        tools.ClearFields.ClearFields(this);
                        break;

                    default:
                        id.setText("");

                        break;
                }

            }

        }

    }

}
